### 添加用户

```bat
# 添加用户
sudo useradd -d /home/xbu xbu -g xbu -m

# 为xbu设置密码
sudo passwd xbu

usermod 命令
# 修改用户所在组
usermod -g 用户组 用户名
    -g # 指定用户所属的组
    -G # 指定用户所属的 附加组
# 为用户指定附加组
sudo usermod -a -G sudo/adm/root 用户名

# 删除用户
sudo userdel -r xbu
    -r ：删除用户同时删除主目录

# 查看有哪些用户组
1、cat /etc/group
    cat /etc/group | grep 用户组 # 通过冠道符查找用户组 
2、groupmod + 三次 tab 键
# 查看用户在哪些组
groups 用户名
# 添加、删除用户组
sudo groupadd xbu
sudo groupdel xbu
```

### 文件归档

```bat
tar -cvf test.tar file1 file2 folder
    -c 生成档案文件，创建打包文件
    -v 显示进度
    -f 指定档案名称，必须放在最后面
tar -xvf test.tar    
    -x 解开档案文件
# 参数
c 创建归档
x 提取归档
t 列出归档内容
v 显示详细信息
f 指出要创建或提取的归档文件名称
z 使用gzip压缩类型
j 使用bz2压缩类型
r 追加 （只能往tar文件中追加
```

### 文件传输

```shell
scp /home/xbu/sonicosv.debug  soniccore@目标IP:/home/soniccore
```

### sameersbn/bind搭建DNS

1. 释放systemd-resolved使用的端口53

```shell
docker run -d --hostname=dns-server --name bind --restart=always \
  -p 53:53/tcp -p 53:53/udp -p 10000:10000/tcp \
  -v /srv/bind:/data \
  -e WEBMIN_ENABLED=true \
  -e ROOT_PASSWORD=wireless_dev \
  -e WEBMIN_INIT_SSL_ENABLED=false \
  sameersbn/bind

docker run -d --hostname=dns-server --name bind --restart=always \
  -p 53:53/tcp -p 53:53/udp -p 10000:10000/tcp \
  -v /srv/bind:/data \

  sameersbn/bind
```

参数说明：

- `-p 53:53/udp` 绑定容器53端口到宿主机的53端口，DNS默认端口

- `-p 10000:10000` 图形化界面管理器端口

- `-e WEBMIN_ENABLED=true` 开启图形化界面管理器

- `-v ~/bind:/data` 挂载本地目录作为dns配置存储

### ubuntu/bind9搭建dns

参考链接：https://blog.csdn.net/xufuangchao/article/details/107558494

```bash
docker run -dit --name bind9 \
  -p 10053:53 \
  -e BIND9_USER=root \
  -e TZ=Asia/Shanghai \
  -v /srv/bind9:/etc/bind \
  ubuntu/bind9
```

配置 named.conf.options

- 添加allow-query { any; };;
- 添加allow-query-cache { any; };: 允许查询缓存的IP地址列表；
- 添加recursion yes;: 允许递归查询；
- 添加allow-recursion { any; };: 允许递归查询的IP地址列表；
- 添加forward only;: 允许转发；
- forwarders { 183.162.1.101; };: 转发列表，183.162.1.101 为前面配置的授权服务器；
- dnssec-validation no;: 关闭 dnssec；

```ini
options {
	directory "/var/cache/bind";

	allow-query { any; };
	allow-query-cache { any; };

	recursion yes;
	allow-recursion { any; };
	recursive-clients 25;

	// Set the IP addresses of your ISP's DNS servers:
	forward only; # 允许转发，注意这条，不加上无法使用上游解析器
	forwarders {
		10.103.202.200;
		114.114.114.114;
	};

	// dnssec-validation auto;
	dnssec-validation no;

	listen-on-v6 { any; };

};

```



### pihole/pihole搭建dns

使用pihole/pihole搭建dns可以通过禁用域名解析来去广告





### Linux遇到的问题

#### 1、登录新建用户时，shell开头为$，不显示用户名和路径

```bat
# Linux系统登录新建用户时，shell开头为$，不显示用户名和路径的解决办法
# 查看/etc/passwd文件后发现，新建的用户未指定shell。我们只需将其指定为/bin/bash即可。
    # 1、切换至root用户
    # 2、使用usermod命令修改shell类型
sudo usermod -s /bin/bash xbu
```

#### 2、Anaconda创建新环境出错

在/opt目录下安装anaconda给所有用户使用，但有些用户没有权限，出现如下错误：

```bat
Collecting package metadata (current_repodata.json): failed

NotWritableError: The current user does not have write permissions to a required path.
  path: /opt/anaconda3/pkgs/cache/9e0f62c3.json
  uid: 1001
  gid: 1001

If you feel that permissions on this path are set incorrectly, you can manually
change them by executing

  $ sudo chown 1001:1001 /opt/anaconda3/pkgs/cache/9e0f62c3.json

In general, it's not advisable to use 'sudo conda'.
# 对于单个用户
# 针对单个用户改变anaconda文件夹的权限，其中需要更改的地方，
# 1、1001:1001 第一个1001是uid, 第二个1001是gid, 这个两个数字根据报错的命令行提示更改
# 2、/opt/anaconda3/， 这是anaconda安装的路径，
sudo chown 1001:1001 /opt/anaconda3/

# 对于多个用户
# 重看所有用户的uuid和gid
cat /etc/passwd 
root:x:0:0:root:/root:/bin/bash
uuidd:x:107:114::/run/uuidd:/usr/sbin/nologin
sonicwall:x:1000:1000:sonicwall:/home/sonicwall:/bin/bash
xbu:x:1001:1001::/home/xbu:/bin/bash
# 此时应该修改为：
sudo chown -R 1000:1001 /opt/anaconda3/
```

#### 3. 修改 dns

参考链接：https://blog.csdn.net/u014453443/article/details/80878061   (ubuntu16)

参考链接：https://blog.csdn.net/m0_46340740/article/details/122020272  (ubuntu20.04)

安装好Ubuntu之后设置了静态IP地址，再重启后就无法解析域名。想重新设置一下DNS，打开 `/etc/resolv.conf`

```shell
cat /etc/resolv.conf
# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
```

内容是一段警告：说这个文件是resolvconf程序动态创建的，不要直接手动编辑，修改将被覆盖。

果不其然，修改后重启就失效了。总结出办法：

首先修改 `/etc/systemd/resolved.conf` 文件，在其中添加dns信息，/etc/systemd/resolved.conf是配置全局dns，优先使用。例如：

```shell
DNS=10.190.202.200 8.8.8.8
```

然后退出保存。

然后以root身份在ubuntu终端中依次执行如下命令：

```shell
systemctl restart systemd-resolved
systemctl enable systemd-resolved

mv /etc/resolv.conf /etc/resolv.conf.bak
ln -s /run/systemd/resolve/resolv.conf /etc/
```

再查看/etc/resolv.conf文件就可以看到新的dns信息已经写入其中了。

dns 8.8.8.8 是谷歌的万能dns，还有一个是114.114.114.114，这2个都可以用的

#### 4. netplan命令和/etc/netplan/*.yaml配置文件

链接：https://www.jianshu.com/p/dbbfe02745fa

在老版的Ubuntu中，是通过/etc/network/interfaces文件进行静态IP地址的配置，通过/etc/resolv.conf进行DNS设置。在新版的Ubuntu中，通过/etc/netplan/目录下的yaml文件进行IP和DNS配置。打开该目录下的配置文件如下：

```yaml
# This file describes the network interfaces available on your system
# For more information, see netplan(5).
network:
  version: 2
  renderer: networkd
  ethernets:
    interface: # <interface> 为要设置静态IP的网络接口名称，比如eth32
      dhcp4: no
      addresses: [10.103.12.47/24]
      gateway4: 10.103.12.1
      nameservers:
        addresses: [10.190.202.200, 114.114.114.114]
network:
  version: 2
  renderer: networkd
  ethernets:
    enp0s31f6:
      dhcp4: no
      addresses: [10.103.12.238/24]
      gateway4: 10.103.12.1
      nameservers:
        addresses: [10.103.230.16, 10.190.202.200, 114.114.114.114]
#DEVICE_NAME：接口的名称。
#dhcp4：是或否取决于动态或静态 IP 寻址
#addresses：[IP_ADDRESS/NETMASK] 设备的 IP 地址以前缀表示法。不要使用网络掩码。
#gateway：连接到外部网络的网关 IP 地址
#nameservers : DNS 名称服务器的地址
```

这是ubuntu服务器版本的配置方法，如果是`桌面版`，可以使用可视化的`NetworkManager来接管网络`，则该配置文件的`renderer字段`可设置为: `NetworkManager`，后面的部分都删除。当然，桌面版也可以按照上文示例设置，而不使用NetworkManager。
 该配置文件的书写格式上有几点需要注意：

- ethernets中的网卡名可以通过ip link指令查看，此处的ens32是本人虚拟机的网卡，替换为你自己的。
- 使用类似于python代码缩进的方式组织代码块。
- 缩进一级至少为两个空格，且前后一致。
- gateway4字段的ip地址不用中括号（只有一个）。
- 本机addresses字段和域名服务器addresses字段都需要中括号，多个ip之间使用逗号分隔。

配置完成后，需要使配置生效

```shell
# 重新生成网络配置文件
sudo netplan generate。
# 应用新的网络配置
sudo netplan apply
##重启网络服务，这个不用执行
service network-manager restart # ubuntu20.04的server版总是找不到网络的这几个服务
```

**使 DNS 生效**

仅仅配置好了配置文件执行sudo netplan apply后dns是不能生效的，第一次需要创建软连接，需要将配置软连接指向/etc/resolv.conf

```shell
sudo mv resolv.conf resolv.conf.init # 重命名原本的resolv.conf
sudo ln -s /run/systemd/resolve/resolv.conf /etc/resolv.conf
```

### apt 安装时使用代理

```shell
sudo apt -o Acquire::http::Proxy="http://10.50.128.110:3128" update
```

### 设置系统代理

但是10开头的IP却怎么设置都无法跳过使用代理，匹配不到

```bash
export all_proxy=http://10.50.128.110:3128
export no_proxy=.xbu.dev,10.*.*.*,192.168.*.*,*.local,localhost,127.0.0.1
```



### docker搭代理服务器

要使用 Docker 构建代理服务器，您可以选择使用常见的代理服务器软件，例如 Squid 或 TinyProxy，并将它们打包到 Docker 容器中。以下是一个使用 Squid 代理服务器的示例：

1. 创建 Dockerfile：

创建一个名为 Dockerfile 的文本文件，其中包含构建 Docker 容器的指令。以下是一个示例 Dockerfile：

```dockerfile
# 使用基础镜像
FROM ubuntu:latest

# 更新包管理器并安装 Squid 代理服务器
RUN apt-get update && apt-get install -y squid

# 复制自定义配置文件到容器中
COPY squid.conf /etc/squid/squid.conf

# 暴露代理服务器端口
EXPOSE 3128

# 启动 Squid 代理服务器
CMD ["squid", "-N"]
```

2. 创建 Squid 配置文件：

创建一个名为 squid.conf 的 Squid 配置文件，根据您的代理服务器需求进行配置。以下是一个示例配置：

```ini
acl localnet src 0.0.0.1-0.255.255.255
acl localnet src 10.0.0.0/8
acl localnet src 100.64.0.0/10
acl localnet src 169.254.0.0/16
acl localnet src 172.16.0.0/12
acl localnet src 192.168.0.0/16
acl localnet src fc00::/7
acl localnet src fe80::/10

# 允许访问所有源
http_access allow localnet
http_access allow localhost

# 允许连接到所有端口
http_port 3128

# 隐藏 Squid 版本信息
via off
forwarded_for delete

# 启用缓存
cache_dir ufs /var/spool/squid 100 16 256
maximum_object_size 1024 MB

# 访问日志
access_log /var/log/squid/access.log
```

